# \[静态链接和动态链接\]

[返回](./Index.md)

## 一、编译的过程

编译分为四步：预处理（预编译）、编译、汇编、链接，静态链接和动态链接属于链接部分。

编译前三步：

1. 预处理。编译器对源文件进行预处理（例如宏定义、#include、预编译指令#ifdef等），生成.i文件。
2. 编译。编译器对.i文件进行词法分析、语法分析和语义分析等主体过程，生成.s汇编文件。
3. 汇编。编译器将.s文件中对应的汇编指令翻译成机器指令，生成可重定位的二进制目标文件，生成.o文件。

现代编译器将一个源代码文件编译成一个未链接的目标文件，然后有链接器将这些目标文件连接起来生成可执行文件。

## 二、静态链接

静态链接将链接文件打包成在项目下的.o文件，在链接阶段，会将汇编生成的.o目标文件与引用到的库文件一起链接打包到可执行文件中。

**特点**：

- 静态库对函数库的链接是放在编译时期完成的。
- 程序运行时与函数库不再产生联系，方便移植。
- 但是浪费了空间和资源，因为所有相关的文件和设计的函数库全部链接合成了一个可执行文件。

## 三、动态链接

动态链接通过把程序按照模块拆分成相对独立的部分，在程序运行时按照程序运行顺序和依赖产生的次序和时间，依次载入内存，最终全部链接成可执行程序。

**特点**：

- 动态链接库的名字形式为"libxxx .so"，前缀是"lib"，后缀名为".so"。
- 在Windows系统中，动态链接文件被称为动态链接库，也就是常见的。.dll扩展名的文件。
- 当多个程序都依赖同一个库时，不需要复制多份副本，不同的程序共享一个库副本。
- 更新时只需要替换原来的目标文件，而无需将所有程序重新链接一遍。
