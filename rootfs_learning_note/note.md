# \[根文件系统\]

## 一、简介

1. 根文件系统时内核启动时所mount（挂载）的第一个文件系统，内核代码映像文件保存在根文件系统中，而内核系统引导启动程序会在根文件系统挂载后从中把一些基本的初始化脚本和服务等加载到内存中去运行。
2. 根文件系统并不是Linux内核镜像的一部分，而是独立于Linux内核镜像之外的镜像。
3. 在嵌入式系统中，根文件系统就是文件系统，其中存放着除了Linux内核之外所有设备厂家的程序、配置、数据。
4. Linux内核代码是Linux官方提供的，根文件系统的结构也是Linux官方决定的，但是根文件系统的内容由设备厂家决定

## 二、根文件系统

### 1-1 什么是根文件系统

根文件系统首先是一个文件系统，它具有文件系统具有的普通文件系统的存储数据文件的功能。与其他文件系统不同的是：
（1）它是内核启动时挂载的第一个文件系统
（2）内核代码的部分文件保存在根文件系统中
（3）系统引导程序会在根文件系统挂在后从中把一些初始化脚本文件和服务加载到内存中去

**根文件系统包含如下内容**：
1> 系统引导和挂载其他文件系统所必要的文件
2> Linux启动时所必需的目录和关键性文件
3> 动态加载的内核模块和内核驱动程序对应的ko文件
4> 许多应用程序的bin目录
ps.任何包括这些Linux系统启动所必须的文件都可以成为根文件系统的一部分。

Linux启动时，第一个必须挂载的就是根文件系统；若系统不能从指定的设备上挂载根文件系统，则系统会出错而退出。
Linux内核和根文件系统是完全独立的两个部分，但是在嵌入式开发中，如果只移植内核到开发板上，而没有根文件系统，那么没有办法真正地启动Linux操作系统，会因为无法加载文件系统而出错。
根文件系统成功加载之后，还可以手动或者自动挂载其他的文件系统。一个系统可以同时存在多个不同的文件系统。

**在Linux中将一个文件系统与一个设备关联起来的过程称为“挂载（mount）”**。使用 mount 命令将一个文件系统附着到当前文件系统层次结构中（根）。在执行挂装时，要提供文件系统类型、文件系统和一个挂装点。根文件系统被挂载到根目录下“/”上后，在根目录下就有根文件系统的各个目录，文件：/bin /sbin /mnt等，再将其他分区挂接到/mnt目录上，/mnt目录下就有这个分区的各个目录，文件。

**小结**：

- Linux系统启动之后，首先由内核挂载的第一个逻辑文件系统称为根文件系统，其中包括系统启动所必需的文件
- 在根文件系统的最顶层目录中，每个目录都有其具体的目的和用途
- 根文件系统的类型没有限制，只要是Linux支持的文件系统类型就可以
- 在Linux下所有的磁盘只有在被挂载后才能使用，这个挂载目录就被称为挂载点或者安装点，然后通过此目录来访问这个分区上的文件或者其他目录
- 根文件系统被挂载到VFS的/root上
- VFS下面的root目录通过chroot操作隐藏了

### 1-2 根文件系统的结构

根文件系统的结构是树形结构，根文件系统挂载到Linux的根目录'/'上（同时也是Linux的VFS的根目录）。
根目录'/'下通常包含了众多子文件和目录，其中有一些是系统预定义的，其中有一些是用户自己定义的。
主要有：

1. 系统文件（如：/boot、/bin、/sbin、/lib、/etc、/usr、/opt、/var）
2. 外设文件系统（如：/mnt、/dev）
3. 内存文件系统（如：/proc、/sys）
4. 登录用户文件系统（如：/root、/home）
5. 其他（如：/misc、/tmp、/lost+found）

一些比较重要的子目录，如下表：

|子目录|作用|
|-----|-----|
|**/bin**|**提供基本的用户命令，如：ls，cp等**|
|/boot|存放的一般是Linux的启动文件和内核|
|**/dev**|**设备文件或者其他的特殊文件，如：mmcblk0p2，fb0**|
|**/etc**|**系统配置文件，包括启动文件**|
|/home|多个用户的主目录|
|**/lib**|**存放应用程序所需的基本库，运行时所需要的共享库，比如：C/C++的标准库，GTK、QT等应用程序的库**|
|/mnt|用于临时挂载的文件系统，比如挂载U盘、SD卡等|
|/opt|某些第三方软件商的软件的安装地点，某些自定义的安装包也会安装到这里|
|**/proc**|**操作系统运行时，进程信息及内核信息（比如：模块加载数、中断申请与使用状态、进程运行状态等）存放在这里，一般挂载proc文件系统，用来表示系统的运行状态，只存在内存中**|
|/root|根用户的主目录，与此对应，普通用户的目录是/home下的某个子目录|
|**/sbin**|**主要放置系统管理和网络管理的必备程序，比如：ifconfig、rmmod等，通常需要root权限**|
|**/sys**|**与/proc相似，挂载sysfs文件系统**|
|/tmp|一些需要生成临时文件的应用程序需要此目录，通常为空，并且此目录必须可写，一般挂载ramfs文件系统|
|**/usr**|**一般存放由用户自由添加的程序或者开源库以及各种不常用的命令等，是共享和制只读的**|
|/var|一些变化的实例和工具等，存放可变数据，如一些系统日志文件等|

### 1-3 根文件系统关键目录的内容

#### 1-3-1 etc目录

/etc目录包含很多文件.许多网络配置文件也在/etc 中.

$\left.\begin{matrix}/etc/rc\\ /etc/rc.d\\ /etc/rc*.d \end{matrix}\right\}=启动、或改变运行级时运行的scripts或scripts的目录$

**/etc/fstab**: 启动时mount -a命令(在/etc/rc 或等效的启动文件中)自动mount的文件系统列表.Linux下，也包括用swapon -a启用的swap区的信息

**/etc/inittab**: init 的配置文件

$\left.\begin{matrix}/etc/profile \\ /etc/csh.login\\ /etc/csh.cshrc   \end{matrix}\right\}= 登录或启动时Bourne或Cshells执行的文件.这允许系统管理员为所有用户建立全局缺省环境$


#### 1-3-2 bin目录

bin为binary的简写，主要放置系统的必备执行文件，例如:
cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar等。

#### 1-3-3 /usr/bin目录

主要放置应用程序工具的必备执行文件，例如：
c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome*、 gzip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb*、wget等。

#### 1-3-4 sbin目录

主要放置系统管理的必备程序，例如:
cfdisk、dhcpcd、dump、e2fsck、fdisk、halt、ifconfig、ifup、 ifdown、init、insmod、lilo、lsmod、mke2fs、modprobe、quotacheck、reboot、rmmod、 runlevel、shutdown等

#### 1-3-5 /usr/sbin目录

主要放置网路管理的必备程序，例如:
dhcpd、httpd、imap、in.*d、inetd、lpd、named、netconfig、nmbd、samba、sendmail、squid、swap、tcpd、tcpdump等




